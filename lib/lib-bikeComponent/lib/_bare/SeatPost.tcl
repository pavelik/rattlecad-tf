 ##+##########################################################################te
 #
 # package: bikeComponent   ->  lib_SeatPost.tcl
 #
 #   canvasCAD is software of Manfred ROSENBERGER
 #       based on tclTk, BWidgets and tdom on their
 #       own Licenses.
 #
 # Copyright (c) Manfred ROSENBERGER, 2016/09/12
 #
 # The author  hereby grant permission to use,  copy, modify, distribute,
 # and  license this  software  and its  documentation  for any  purpose,
 # provided that  existing copyright notices  are retained in  all copies
 # and that  this notice  is included verbatim  in any  distributions. No
 # written agreement, license, or royalty  fee is required for any of the
 # authorized uses.  Modifications to this software may be copyrighted by
 # their authors and need not  follow the licensing terms described here,
 # provided that the new terms are clearly indicated on the first page of
 # each file where they apply.
 #
 # IN NO  EVENT SHALL THE AUTHOR  OR DISTRIBUTORS BE LIABLE  TO ANY PARTY
 # FOR  DIRECT, INDIRECT, SPECIAL,  INCIDENTAL, OR  CONSEQUENTIAL DAMAGES
 # ARISING OUT  OF THE  USE OF THIS  SOFTWARE, ITS DOCUMENTATION,  OR ANY
 # DERIVATIVES  THEREOF, EVEN  IF THE  AUTHOR  HAVE BEEN  ADVISED OF  THE
 # POSSIBILITY OF SUCH DAMAGE.
 #
 # THE  AUTHOR  AND DISTRIBUTORS  SPECIFICALLY  DISCLAIM ANY  WARRANTIES,
 # INCLUDING,   BUT   NOT  LIMITED   TO,   THE   IMPLIED  WARRANTIES   OF
 # MERCHANTABILITY,    FITNESS   FOR    A    PARTICULAR   PURPOSE,    AND
 # NON-INFRINGEMENT.  THIS  SOFTWARE IS PROVIDED  ON AN "AS  IS" BASIS,
 # AND  THE  AUTHOR  AND  DISTRIBUTORS  HAVE  NO  OBLIGATION  TO  PROVIDE
 # MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.
 #
 # ---------------------------------------------------------------------------
 #  namespace:  bikeComponent::SeatPost      
 # ---------------------------------------------------------------------------
 #
 #

oo::class create bikeComponent::bareSeatPost {

        # <SeatPost>
        #     <Setback>25.00</Setback>
        #     <PivotOffset>40.00</PivotOffset>
        #     <Diameter>27.20</Diameter>
        # </SeatPost>

    superclass bikeComponent::ComponentBare
    
        #
    variable packageHomeDir
        #
    
    constructor {} {
            #
        set   objectName    "SeatPost"
        next $objectName
            #
        puts "              -> class ComponentBare: $objectName"
            #

        variable Config             ; array set Config {
                                            Style                Ritchey
                                        }
        variable Scalar             ; array set Scalar {
                                            Length                   250.00
                                            Diameter                  27.20
                                            PivotOffset               40.00
                                            Setback                   25.00
                                        }
        variable Position           ; array set Position {
                                            ShaftStart              {0 0}
                                            ShaftEnd                {0 0}
                                        }
            #
        variable ComponentNode    
            #
        set ComponentNode(XZ)       [my readSVGFile [file join $packageHomeDir components default_template.svg]]
        variable nodeSVG_Empty      [my readSVGFile [file join $packageHomeDir components default_template.svg]]
            #
    }

    #-------------------------------------------------------------------------
        #  create custom SeatPost
        #
    method update {} {
        my update_XZ
    }
        #
    method update_XZ {} {
            #
        variable Config
        variable Position
        variable Scalar
            #
        variable ComponentNode      
            #
       
            #
        set compDoc         [$ComponentNode(XZ) ownerDocument ]
        set compNode        [$ComponentNode(XZ) find id customComponent]
            
            # puts ""
            # puts "   -------------------------------"
            # puts "   createCrank_Custom"
            # puts "       crankLength:    $crankLength"
            # puts "       teethCountList: $teethCountList"
            # puts "       teethCountMax:  $teethCountMax"
            # puts "       bcDiameter:     $bcDiameter"
        
            #
            # -- cleanup
            #
        foreach childNode [$compNode childNodes] {
            $compNode   removeChild $childNode
            $childNode  delete
        }
            #    
            #
            #   <?xml version="1.0" encoding="UTF-8"?>
            #   <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
            #   <svg width="420mm" height="297mm" viewBox="-210 -148.5 420 297" xmlns="http://www.w3.org/2000/svg">
            #       <defs id="_tag_23_"/>
            #       <g id="trashNode_001"/>
            #       <g id="_tag_24_">
            #           <circle id="center_00" cx="99.0" cy="99.0" r="4.5" fill="none" stroke="black" stroke-width="0.1"/>
            #           <polyline class="fil1 str1" id="outerShape" points="136.46,99.0 135.841015625,93.785703125 134.79500000000002,88.615 133.312109375,83.592421875 131.3825,78.8225 128.996328125,74.409765625 126.14375,70.45875 122.814921875,67.073984375 119.0,64.36 119.0,64.36 116.75142578125,63.15064453125 114.41953125,62.08390625 112.01005859375,61.16552734375 109.52875,60.401250000000005 106.98134765625001,59.79681640625 104.37359375,59.35796875 101.71123046875,59.09044921875 99.0,59.0 99.0,59.0 96.99791015625,59.049296875 95.02078125,59.195625 93.07107421875,59.436640625 91.15125,59.77 89.26376953125,60.193359375 87.41109375,60.704375 85.59568359375,61.300703125 83.82000000000001,61.980000000000004 83.82000000000001,61.980000000000004 83.60748046875,62.06201171875 83.40609375,62.13359375 83.21759765625,62.20306640625 83.04375,62.27875 82.88630859375,62.36896484375 82.74703125,62.48203125 82.62767578125,62.62626953125 82.53,62.81 82.53,62.81 82.466171875,63.010585937500004 82.443125,63.2015625 82.45476562500001,63.3855078125 82.495,63.565000000000005 82.557734375,63.7426171875 82.636875,63.9209375 82.726328125,64.1025390625 82.82000000000001,64.29 83.8,66.31 83.93951171875,66.58708984375001 84.11734375,66.89734375 84.34369140625,67.22423828125 84.62875,67.55125 84.98271484375,67.86185546875001 85.41578125,68.13953125 85.93814453125,68.36775390625 86.56,68.53 86.56,68.53 91.791328125,70.02054687500001 96.595625,72.45 100.883359375,75.68007812500001 104.565,79.5725 107.551015625,83.988984375 109.751875,88.79125 111.078046875,93.841015625 111.44,99.0" fill="none" stroke="black" stroke-width="0.1"/>
            #           <polyline class="fil1 str1" id="innerShape" points="83.3,65.26 83.42384765625,65.47828125 83.59140625,65.654375 83.78919921875,65.79015625 84.00375,65.8875 84.22158203125001,65.94828125000001 84.42921875,65.974375 84.61318359375001,65.96765625 84.76,65.93 84.76,65.93 86.41900390625,65.26433593750001 88.11703125,64.6790625 89.85185546875,64.1767578125 91.62125,63.76 93.42298828125,63.4313671875 95.25484375,63.1934375 97.11458984375,63.0487890625 99.0,63.0 99.0,63.0 100.68580078125001,63.03865234375 102.35203125,63.15359375 103.99693359375,63.34330078125 105.61875,63.60625 107.21572265625001,63.94091796875 108.78609375,64.34578125 110.32810546875,64.81931640625 111.84,65.36 111.84,65.36 113.84615234375,66.3265625 116.03359375000001,67.74875 118.22455078125,69.5365625 120.24125000000001,71.60000000000001 121.90591796875,73.8490625 123.04078125000001,76.19375000000001 123.46806640625,78.5440625 123.01,80.81" fill="none" stroke="black" stroke-width="0.1"/>
            #       </g>
            #   </svg>
            #
            #
            #    <polyline style="fill:none;stroke:#ff0000;stroke-width:0.1" id="polyline10_1" points="23.99991,-31.306068999999994 22.111410000000006,-32.82696899999999 19.953210000000013,-34.329768999999985 18.09311000000001,-35.44976899999998 15.772010000000009,-36.646768999999985 13.602410000000006,-37.584268999999985 11.058910000000012,-38.481568999999986 8.758810000000011,-39.11966899999999 6.319010000000006,-39.625368999999985 3.368710000000007,-40.009568999999985 0.17230700000000354,-40.14196899999998 -3.3425929999999937,-39.98136899999998 -6.170492999999993,-39.59366899999998 -9.007593,-38.973068999999974 -11.125992999999994,-38.35156899999998 -13.105892999999995,-37.641768999999975 -14.277992999999995,-36.87556899999998 -14.833092999999991,-36.407568999999974 -15.008492999999987,-35.70976899999997 -14.624392999999984,-34.12406899999998 -14.363692999999984,-33.49336899999997 -14.198892999999984,-33.35716899999997 -13.999392999999984,-33.25226899999997 -13.769592999999986,-33.13836899999997 -13.539592999999982,-33.082168999999965 -13.277692999999985,-33.07456899999997 -13.066192999999984,-33.11396899999997 -12.855292999999989,-33.19366899999997 -12.635892999999996,-33.285068999999964 -12.027092999999994,-33.59896899999997 -10.605792999999991,-34.26166899999997 -8.99789299999999,-34.90046899999997 -6.825092999999995,-35.589968999999975 -4.652592999999996,-36.092968999999975 -2.3469929999999977,-36.434968999999974 -0.3735929999999996,-36.57696899999998 2.0567099999999954,-36.56606899999998 4.6777099999999905,-36.32356899999998 7.236009999999993,-35.84716899999998 9.744709999999998,-35.10896899999998 12.205010000000001,-34.18526899999998 14.835409999999996,-32.85806899999997 17.054509999999993,-31.45046899999997 17.054509999999993,-31.45046899999997 14.835409999999996,-32.85806899999997 12.205010000000001,-34.18526899999998 9.744709999999998,-35.10896899999997 7.236009999999993,-35.84716899999997 4.6777099999999905,-36.32356899999997 2.0567099999999954,-36.56606899999997 -0.3735929999999996,-36.57696899999997 -2.3469929999999977,-36.43496899999997 -4.652592999999996,-36.09296899999997 -6.825092999999995,-35.58996899999997 -8.99789299999999,-34.90046899999997 -10.605792999999991,-34.26166899999997 -12.027092999999994,-33.59896899999997 -12.635892999999996,-33.285068999999964 -12.855292999999989,-33.19366899999997 -13.066192999999984,-33.11396899999997 -13.277692999999985,-33.07456899999997 -13.539592999999982,-33.082168999999965 -13.769592999999986,-33.13836899999997 -13.999392999999984,-33.25226899999997 -14.21119299999998,-33.367268999999965 -14.363692999999984,-33.49336899999996 -14.158192999999983,-32.99636899999996 -13.893592999999981,-32.65746899999996 -13.587292999999988,-32.44276899999997 -13.122492999999992,-32.20396899999997 -12.46789299999999,-31.945568999999978 -11.73629299999999,-31.680568999999977 -11.018292999999986,-31.393668999999974 -10.300392999999985,-31.06086899999997 -9.569292999999988,-30.65806899999997 -8.811392999999981,-30.160968999999966 -5.415292999999977,-27.879168999999962" fill="none" stroke="black" stroke-width="0.1"/>
            #
        set polyline_Head   "12.6235,-1.2235 12.6243,-1.4196 12.5121,-2.331 12.2201,-5.2588 11.6905,-8.4246 10.9431,-11.8045 10.1805,-14.598 9.4629,-16.8689 8.842,-18.5659 7.929,-20.7067 6.6987,-23.1557 5.1259,-25.7772 3.1854,-28.4358 1.4197,-30.4377 -0.3266,-32.2934 -2.1765,-34.0033 -4.065,-35.5242 -6.2232,-37.027 -8.0833,-38.147 -10.4044,-39.344 -12.574,-40.2815 -15.1175,-41.1788 -17.4176,-41.8169 -19.8574,-42.3226 -22.8077,-42.7068 -26.0041,-42.8392 -29.519,-42.6786 -32.3469,-42.2909 -35.184,-41.6703 -37.3024,-41.0488 -39.2823,-40.339 -40.4544,-39.5728 -41.0095,-39.1048 -41.1849,-38.407 -40.8008,-36.8213 -40.5401,-36.1906 -40.3753,-36.0544 -40.1758,-35.9495 -39.946,-35.8356 -39.716,-35.7794 -39.4541,-35.7718 -39.2426,-35.8112 -39.0317,-35.8909 -38.8123,-35.9823 -38.2035,-36.2962 -36.7822,-36.9589 -35.1743,-37.5977 -33.0015,-38.2872 -30.829,-38.7902 -28.5234,-39.1322 -26.55,-39.2742 -24.1197,-39.2633 -21.4987,-39.0208 -18.9404,-38.5444 -16.4317,-37.8062 -13.9714,-36.8825 -11.341,-35.5553 -9.1219,-34.1477 -7.1697,-32.6505 -5.5012,-31.1377 -3.9845,-29.531 -2.7452,-28.0105 -1.4261,-26.1201 -0.7351,-23.5411 -1.0263,-20.6288 -0.7351,-23.5411 -1.4261,-26.1201 -2.7452,-28.0105 -3.9845,-29.531 -5.5012,-31.1377 -7.1697,-32.6505 -9.1219,-34.1477 -11.341,-35.5553 -13.9714,-36.8825 -16.4317,-37.8062 -18.9404,-38.5444 -21.4987,-39.0208 -24.1197,-39.2633 -26.55,-39.2742 -28.5234,-39.1322 -30.829,-38.7902 -33.0015,-38.2872 -35.1743,-37.5977 -36.7822,-36.9589 -38.2035,-36.2962 -38.8123,-35.9823 -39.0317,-35.8909 -39.2426,-35.8112 -39.4541,-35.7718 -39.716,-35.7794 -39.946,-35.8356 -40.1758,-35.9495 -40.3876,-36.0645 -40.5401,-36.1906 -40.3346,-35.6936 -40.07,-35.3547 -39.7637,-35.14 -39.2989,-34.9012 -38.6443,-34.6428 -37.9127,-34.3778 -37.1947,-34.0909 -36.4768,-33.7581 -35.7457,-33.3553 -34.9878,-32.8582 -31.5917,-30.5764 -27.9996,-27.9578 -24.4159,-24.7819 -20.2003,-20.1957 -16.7713,-15.5453 -15.3735,-13.3729 -14.7011,-11.9642 -14.0365,-10.2897 -13.5986,-9.044 -13.171,-7.6491 -12.8142,-6.1974 -12.5885,-4.7813 -12.5546,-3.4932 -12.6218,1.2235" 
        #set polyline_Head   "23.99991,-31.306068999999994 22.111410000000006,-32.82696899999999 19.953210000000013,-34.329768999999985 18.09311000000001,-35.44976899999998 15.772010000000009,-36.646768999999985 13.602410000000006,-37.584268999999985 11.058910000000012,-38.481568999999986 8.758810000000011,-39.11966899999999 6.319010000000006,-39.625368999999985 3.368710000000007,-40.009568999999985 0.17230700000000354,-40.14196899999998 -3.3425929999999937,-39.98136899999998 -6.170492999999993,-39.59366899999998 -9.007593,-38.973068999999974 -11.125992999999994,-38.35156899999998 -13.105892999999995,-37.641768999999975 -14.277992999999995,-36.87556899999998 -14.833092999999991,-36.407568999999974 -15.008492999999987,-35.70976899999997 -14.624392999999984,-34.12406899999998 -14.363692999999984,-33.49336899999997 -14.198892999999984,-33.35716899999997 -13.999392999999984,-33.25226899999997 -13.769592999999986,-33.13836899999997 -13.539592999999982,-33.082168999999965 -13.277692999999985,-33.07456899999997 -13.066192999999984,-33.11396899999997 -12.855292999999989,-33.19366899999997 -12.635892999999996,-33.285068999999964 -12.027092999999994,-33.59896899999997 -10.605792999999991,-34.26166899999997 -8.99789299999999,-34.90046899999997 -6.825092999999995,-35.589968999999975 -4.652592999999996,-36.092968999999975 -2.3469929999999977,-36.434968999999974 -0.3735929999999996,-36.57696899999998 2.0567099999999954,-36.56606899999998 4.6777099999999905,-36.32356899999998 7.236009999999993,-35.84716899999998 9.744709999999998,-35.10896899999998 12.205010000000001,-34.18526899999998 14.835409999999996,-32.85806899999997 17.054509999999993,-31.45046899999997 17.054509999999993,-31.45046899999997 14.835409999999996,-32.85806899999997 12.205010000000001,-34.18526899999998 9.744709999999998,-35.10896899999997 7.236009999999993,-35.84716899999997 4.6777099999999905,-36.32356899999997 2.0567099999999954,-36.56606899999997 -0.3735929999999996,-36.57696899999997 -2.3469929999999977,-36.43496899999997 -4.652592999999996,-36.09296899999997 -6.825092999999995,-35.58996899999997 -8.99789299999999,-34.90046899999997 -10.605792999999991,-34.26166899999997 -12.027092999999994,-33.59896899999997 -12.635892999999996,-33.285068999999964 -12.855292999999989,-33.19366899999997 -13.066192999999984,-33.11396899999997 -13.277692999999985,-33.07456899999997 -13.539592999999982,-33.082168999999965 -13.769592999999986,-33.13836899999997 -13.999392999999984,-33.25226899999997 -14.21119299999998,-33.367268999999965 -14.363692999999984,-33.49336899999996 -14.158192999999983,-32.99636899999996 -13.893592999999981,-32.65746899999996 -13.587292999999988,-32.44276899999997 -13.122492999999992,-32.20396899999997 -12.46789299999999,-31.945568999999978 -11.73629299999999,-31.680568999999977 -11.018292999999986,-31.393668999999974 -10.300392999999985,-31.06086899999997 -9.569292999999988,-30.65806899999997 -8.811392999999981,-30.160968999999966 -5.415292999999977,-27.879168999999962"
        set polyline_Head   "19.953210000000013,-34.329768999999985 18.09311000000001,-35.44976899999998 15.772010000000009,-36.646768999999985 13.602410000000006,-37.584268999999985 11.058910000000012,-38.481568999999986 8.758810000000011,-39.11966899999999 6.319010000000006,-39.625368999999985 3.368710000000007,-40.009568999999985 0.17230700000000354,-40.14196899999998 -3.3425929999999937,-39.98136899999998 -6.170492999999993,-39.59366899999998 -9.007593,-38.973068999999974 -11.125992999999994,-38.35156899999998 -13.105892999999995,-37.641768999999975 -14.277992999999995,-36.87556899999998 -14.833092999999991,-36.407568999999974 -15.008492999999987,-35.70976899999997 -14.624392999999984,-34.12406899999998 -14.363692999999984,-33.49336899999997 -14.198892999999984,-33.35716899999997 -13.999392999999984,-33.25226899999997 -13.769592999999986,-33.13836899999997 -13.539592999999982,-33.082168999999965 -13.277692999999985,-33.07456899999997 -13.066192999999984,-33.11396899999997 -12.855292999999989,-33.19366899999997 -12.635892999999996,-33.285068999999964 -12.027092999999994,-33.59896899999997 -10.605792999999991,-34.26166899999997 -8.99789299999999,-34.90046899999997 -6.825092999999995,-35.589968999999975 -4.652592999999996,-36.092968999999975 -2.3469929999999977,-36.434968999999974 -0.3735929999999996,-36.57696899999998 2.0567099999999954,-36.56606899999998 4.6777099999999905,-36.32356899999998 7.236009999999993,-35.84716899999998 9.744709999999998,-35.10896899999998 12.205010000000001,-34.18526899999998 14.835409999999996,-32.85806899999997 17.054509999999993,-31.45046899999997 17.054509999999993,-31.45046899999997 14.835409999999996,-32.85806899999997 12.205010000000001,-34.18526899999998 9.744709999999998,-35.10896899999997 7.236009999999993,-35.84716899999997 4.6777099999999905,-36.32356899999997 2.0567099999999954,-36.56606899999997 -0.3735929999999996,-36.57696899999997 -2.3469929999999977,-36.43496899999997 -4.652592999999996,-36.09296899999997 -6.825092999999995,-35.58996899999997 -8.99789299999999,-34.90046899999997 -10.605792999999991,-34.26166899999997 -12.027092999999994,-33.59896899999997 -12.635892999999996,-33.285068999999964 -12.855292999999989,-33.19366899999997 -13.066192999999984,-33.11396899999997 -13.277692999999985,-33.07456899999997 -13.539592999999982,-33.082168999999965 -13.769592999999986,-33.13836899999997 -13.999392999999984,-33.25226899999997 -14.21119299999998,-33.367268999999965 -14.363692999999984,-33.49336899999996 -14.158192999999983,-32.99636899999996 -13.893592999999981,-32.65746899999996 -13.587292999999988,-32.44276899999997 -13.122492999999992,-32.20396899999997 -12.46789299999999,-31.945568999999978 -11.73629299999999,-31.680568999999977 -11.018292999999986,-31.393668999999974 -10.300392999999985,-31.06086899999997 -9.569292999999988,-30.65806899999997 -8.811392999999981,-30.160968999999966 -5.415292999999977,-27.879168999999962"
            #
        set coneLength       0.0    ;# 75.0 - 20160122
        set verticalOffset   7.5  
            #
        set polyline {}
        foreach pt $polyline_Head {
            lassign [split $pt ,]  x y
                # foreach {x y} [split $pt ,] break
            set x [expr {$x + 0}]
            # set x [expr $x + 25]
            # set x [expr $x + $Scalar(Setback)]
            set y [expr {$y + 40 - $Scalar(PivotOffset) + $verticalOffset}]
            append polyline " $x,$y"
        }
            #
        set pt_poly01   [string map {, { }} [lindex $polyline end]]
        set pt_poly02   [string map {, { }} [lindex $polyline 0]]
            #
        set radius_SP   [expr {0.5 * $Scalar(Diameter)}]
            #
        set pt_21       [list [expr  {1.0 * $Scalar(Setback)}] [expr {40 - $Scalar(PivotOffset)}]]
        set pt_31       [list [expr  {1.0 * $Scalar(Setback)}] [expr {40 - $Scalar(PivotOffset)}]]   
        set pt_41       [list [expr  {1.0 * $Scalar(Setback)}] [expr {60 - $Scalar(PivotOffset)}]]   
        set pt_51       [list [expr  {1.0 * $Scalar(Setback)}] $Scalar(Length)]
            #
            # set pt_31       [list [expr  1.0 * $Scalar(Setback)] [expr 50 - $Scalar(PivotOffset) + $coneLength]]   
            #
            # set pt_31       [list $Scalar(PivotOffset) 50]    
            # set pt_21       [list $Scalar(PivotOffset) [expr 50 + $coneLength]]
            # set pt_51       [list $Scalar(PivotOffset) $Scalar(Length)]
            #
        set pt_50       [vectormath::addVector $pt_51   [list [expr { 0 - 1.0 * $radius_SP}]  0]]
        set pt_52       [vectormath::addVector $pt_51   [list [expr { 0 + 1.0 * $radius_SP}]  0]]
            #
        set pt_40       [vectormath::addVector $pt_41   [list [expr { 0 - 1.0 * $radius_SP}]  0]]
        set pt_42       [vectormath::addVector $pt_41   [list [expr { 0 + 1.0 * $radius_SP}]  0]]
            #
        set pt_30       [vectormath::addVector $pt_31   [list [expr { 1 - 1.0 * $radius_SP}]  0]]
        set pt_32       [vectormath::addVector $pt_31   [list [expr {-1 + 1.0 * $radius_SP}]  0]]
            #
        if {$Scalar(Setback) > 8} {
            set pt_30       [vectormath::addVector $pt_30 {0  3}]
            set pt_32       [vectormath::addVector $pt_32 {0  3}]
            set pt_20       [vectormath::addVector [vectormath::center  $pt_poly01 $pt_30] {2 -1}]
            set pt_22       [vectormath::addVector [vectormath::center  $pt_poly02 $pt_32] {2 -2}]
        } else {
            set pt_30       [vectormath::addVector $pt_30 {0 -3}]
            set pt_32       [vectormath::addVector $pt_32 {0  3}]
            set pt_20       [vectormath::addVector [vectormath::center  $pt_poly01 $pt_30] {2 -2}]
            set pt_22       [vectormath::addVector [vectormath::center  $pt_poly02 $pt_32] {2 -1}]
        }
            #
            #
        foreach pt [list $pt_20 $pt_30 $pt_40 $pt_50 $pt_52 $pt_42 $pt_32 $pt_22] {
            lassign $pt  x y
                # foreach {x y} $pt break
            append polyline " $x,$y"
        }
            #
            #
        set verticalOffset 9.5    
            #
        set polygon {}
        foreach pt $polyline {
            lassign [split $pt ,]  x y
                # foreach {x y} [split $pt ,] break
            # set x [expr $x + $Scalar(Setback)]
            # set y [expr $y + $verticalOffset]
            append polygon " $x,$y"
        }
            #
        set Position(ShaftStart)    [vectormath::mirrorPoint {0 0} {1 0} $pt_31]
        set Position(ShaftEnd)      [vectormath::mirrorPoint {0 0} {1 0} $pt_51]
        #set Position(ShaftStart)    [vectormath::rotatePoint {0 0} $pt_31 180]
        #set Position(ShaftEnd)      [vectormath::rotatePoint {0 0} $pt_51 180]
        #set Position(ShaftStart)    [vectormath::rotatePoint {0 0} [vectormath::addVector $pt_31 [list $Scalar(Setback) $verticalOffset]] 180] 
        #set Position(ShaftEnd)      [vectormath::rotatePoint {0 0} [vectormath::addVector $pt_51 [list $Scalar(Setback) $verticalOffset]] 180]
            #

            #
        set polygon [string trim $polygon]    
            #
        set newNode [$compDoc createElement polygon]
            $compNode   appendChild     $newNode
            $newNode    setAttribute    id      OuterShape
            $newNode    setAttribute    style   "stroke:black;fill:#f2f2f2;stroke-width:0.2"
            $newNode    setAttribute    points  $polygon
            #
            #
            # puts "  ----> $polygon        "
            #
   
            #
            # -- cleanup attribure: xlmns from first layer
            #
        foreach childNode [$compNode childNodes] {
            # puts "  -> $childNode"
            catch {$childNode removeAttribute xmlns}
        }
            #
        # puts "[$nodeSVG asXML]"    
            #
        return
            #

    }    
        #
    method update_XZ_new {} {
            #
            # 20161118 -- a more geometric approach
            #
        variable Config
        variable Scalar
            #
        variable ComponentNode      
            #
       
            #
        set compDoc         [$ComponentNode(XZ) ownerDocument ]
        set compNode        [$ComponentNode(XZ) find id customComponent]
            
            # puts ""
            # puts "   -------------------------------"
            # puts "   createCrank_Custom"
            # puts "       crankLength:    $crankLength"
            # puts "       teethCountList: $teethCountList"
            # puts "       teethCountMax:  $teethCountMax"
            # puts "       bcDiameter:     $bcDiameter"
        
            #
            # -- cleanup
            #
        foreach childNode [$compNode childNodes] {
            $compNode   removeChild $childNode
            $childNode  delete
        }
            #    
        set coneLength  20.0    ;# 75.0 - 20160122
            #
            #   <?xml version="1.0" encoding="UTF-8"?>
            #   <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
            #   <svg width="420mm" height="297mm" viewBox="-210 -148.5 420 297" xmlns="http://www.w3.org/2000/svg">
            #       <defs id="_tag_23_"/>
            #       <g id="trashNode_001"/>
            #       <g id="_tag_24_">
            #           <circle id="center_00" cx="99.0" cy="99.0" r="4.5" fill="none" stroke="black" stroke-width="0.1"/>
            #           <polyline class="fil1 str1" id="outerShape" points="136.46,99.0 135.841015625,93.785703125 134.79500000000002,88.615 133.312109375,83.592421875 131.3825,78.8225 128.996328125,74.409765625 126.14375,70.45875 122.814921875,67.073984375 119.0,64.36 119.0,64.36 116.75142578125,63.15064453125 114.41953125,62.08390625 112.01005859375,61.16552734375 109.52875,60.401250000000005 106.98134765625001,59.79681640625 104.37359375,59.35796875 101.71123046875,59.09044921875 99.0,59.0 99.0,59.0 96.99791015625,59.049296875 95.02078125,59.195625 93.07107421875,59.436640625 91.15125,59.77 89.26376953125,60.193359375 87.41109375,60.704375 85.59568359375,61.300703125 83.82000000000001,61.980000000000004 83.82000000000001,61.980000000000004 83.60748046875,62.06201171875 83.40609375,62.13359375 83.21759765625,62.20306640625 83.04375,62.27875 82.88630859375,62.36896484375 82.74703125,62.48203125 82.62767578125,62.62626953125 82.53,62.81 82.53,62.81 82.466171875,63.010585937500004 82.443125,63.2015625 82.45476562500001,63.3855078125 82.495,63.565000000000005 82.557734375,63.7426171875 82.636875,63.9209375 82.726328125,64.1025390625 82.82000000000001,64.29 83.8,66.31 83.93951171875,66.58708984375001 84.11734375,66.89734375 84.34369140625,67.22423828125 84.62875,67.55125 84.98271484375,67.86185546875001 85.41578125,68.13953125 85.93814453125,68.36775390625 86.56,68.53 86.56,68.53 91.791328125,70.02054687500001 96.595625,72.45 100.883359375,75.68007812500001 104.565,79.5725 107.551015625,83.988984375 109.751875,88.79125 111.078046875,93.841015625 111.44,99.0" fill="none" stroke="black" stroke-width="0.1"/>
            #           <polyline class="fil1 str1" id="innerShape" points="83.3,65.26 83.42384765625,65.47828125 83.59140625,65.654375 83.78919921875,65.79015625 84.00375,65.8875 84.22158203125001,65.94828125000001 84.42921875,65.974375 84.61318359375001,65.96765625 84.76,65.93 84.76,65.93 86.41900390625,65.26433593750001 88.11703125,64.6790625 89.85185546875,64.1767578125 91.62125,63.76 93.42298828125,63.4313671875 95.25484375,63.1934375 97.11458984375,63.0487890625 99.0,63.0 99.0,63.0 100.68580078125001,63.03865234375 102.35203125,63.15359375 103.99693359375,63.34330078125 105.61875,63.60625 107.21572265625001,63.94091796875 108.78609375,64.34578125 110.32810546875,64.81931640625 111.84,65.36 111.84,65.36 113.84615234375,66.3265625 116.03359375000001,67.74875 118.22455078125,69.5365625 120.24125000000001,71.60000000000001 121.90591796875,73.8490625 123.04078125000001,76.19375000000001 123.46806640625,78.5440625 123.01,80.81" fill="none" stroke="black" stroke-width="0.1"/>
            #       </g>
            #   </svg>
            #
            #
        set polylineOuterShape "37.46000000000001,0.0 36.84101562500001,-5.214296875000002 35.795000000000016,-10.385000000000005 34.312109375000006,-15.407578125 32.38249999999999,-20.177499999999995 29.99632812499999,-24.590234374999994 27.143749999999997,-28.541250000000005 23.814921874999996,-31.926015625000005 20.0,-34.64 20.0,-34.64 17.751425781250006,-35.84935546875 15.419531250000006,-36.91609375 13.010058593750003,-37.83447265625 10.528750000000002,-38.598749999999995 7.9813476562500085,-39.20318359375 5.373593749999998,-39.64203125 2.711230468750003,-39.90955078125 0.0,-40.0 0.0,-40.0 -2.0020898437499994,-39.950703125 -3.979218750000001,-39.804375 -5.928925781250001,-39.563359375 -7.8487499999999955,-39.23 -9.736230468749994,-38.806640625 -11.588906249999994,-38.295625 -13.404316406250004,-37.699296875 -15.179999999999993,-37.019999999999996 -15.179999999999993,-37.019999999999996 -15.392519531250002,-36.93798828125 -15.593906250000003,-36.86640625 -15.782402343749993,-36.79693359375 -15.956249999999997,-36.72125 -16.11369140625,-36.63103515625 -16.252968749999994,-36.51796875 -16.372324218749995,-36.37373046875 -16.47,-36.19 -16.47,-36.19 -16.533828125,-35.989414062499996 -16.556875000000005,-35.7984375 -16.545234374999993,-35.6144921875 -16.504999999999995,-35.434999999999995 -16.442265625000005,-35.2573828125 -16.363124999999997,-35.0790625 -16.273671875000005,-34.8974609375 -16.179999999999993,-34.709999999999994 -15.200000000000003,-32.69 -15.060488281250002,-32.41291015624999 -14.882656249999997,-32.102656249999995 -14.656308593749998,-31.775761718750005 -14.371250000000003,-31.448750000000004 -14.017285156249997,-31.138144531249992 -13.584218750000005,-30.860468749999995 -13.061855468749997,-30.63224609375 -12.439999999999998,-30.47 -12.439999999999998,-30.47 -7.208671874999993,-28.979453124999992 -2.4043750000000017,-26.549999999999997 1.8833593749999977,-23.31992187499999 5.564999999999998,-19.427499999999995 8.551015625000005,-15.011015624999999 10.751874999999998,-10.208749999999995 12.078046874999998,-5.158984375000003 12.439999999999998,0.0"
        set polylineInnerShape "-15.700000000000003,-33.739999999999995 -15.576152343749996,-33.521718750000005 -15.408593749999994,-33.345625 -15.21080078125,-33.209843750000005 -14.996250000000003,-33.1125 -14.778417968749991,-33.05171874999999 -14.570781249999996,-33.025625000000005 -14.386816406249991,-33.032343749999995 -14.239999999999995,-33.06999999999999 -14.239999999999995,-33.06999999999999 -12.580996093750002,-33.73566406249999 -10.882968750000003,-34.3209375 -9.148144531249997,-34.8232421875 -7.378749999999997,-35.24 -5.577011718750001,-35.5686328125 -3.7451562499999937,-35.8065625 -1.8854101562500034,-35.9512109375 0.0,-36.0 0.0,-36.0 1.685800781250009,-35.96134765625 3.352031249999996,-35.84640625 4.996933593750001,-35.65669921875 6.618750000000006,-35.39375 8.215722656250009,-35.05908203125 9.786093750000006,-34.65421875 11.328105468749996,-34.180683593750004 12.840000000000003,-33.64 12.840000000000003,-33.64 14.846152343750006,-32.673437500000006 17.03359375000001,-31.25125 19.224550781250002,-29.463437499999998 21.241250000000008,-27.39999999999999 22.905917968750003,-25.150937499999998 24.04078125000001,-22.80624999999999 24.468066406250003,-20.455937500000005 24.010000000000005,-18.189999999999998"
            #
        if 0 {
            # -- a temporary code to translate curves
            set polygon {}
            set polyline "136.46,99.0 135.841015625,93.785703125 134.79500000000002,88.615 133.312109375,83.592421875 131.3825,78.8225 128.996328125,74.409765625 126.14375,70.45875 122.814921875,67.073984375 119.0,64.36 119.0,64.36 116.75142578125,63.15064453125 114.41953125,62.08390625 112.01005859375,61.16552734375 109.52875,60.401250000000005 106.98134765625001,59.79681640625 104.37359375,59.35796875 101.71123046875,59.09044921875 99.0,59.0 99.0,59.0 96.99791015625,59.049296875 95.02078125,59.195625 93.07107421875,59.436640625 91.15125,59.77 89.26376953125,60.193359375 87.41109375,60.704375 85.59568359375,61.300703125 83.82000000000001,61.980000000000004 83.82000000000001,61.980000000000004 83.60748046875,62.06201171875 83.40609375,62.13359375 83.21759765625,62.20306640625 83.04375,62.27875 82.88630859375,62.36896484375 82.74703125,62.48203125 82.62767578125,62.62626953125 82.53,62.81 82.53,62.81 82.466171875,63.010585937500004 82.443125,63.2015625 82.45476562500001,63.3855078125 82.495,63.565000000000005 82.557734375,63.7426171875 82.636875,63.9209375 82.726328125,64.1025390625 82.82000000000001,64.29 83.8,66.31 83.93951171875,66.58708984375001 84.11734375,66.89734375 84.34369140625,67.22423828125 84.62875,67.55125 84.98271484375,67.86185546875001 85.41578125,68.13953125 85.93814453125,68.36775390625 86.56,68.53 86.56,68.53 91.791328125,70.02054687500001 96.595625,72.45 100.883359375,75.68007812500001 104.565,79.5725 107.551015625,83.988984375 109.751875,88.79125 111.078046875,93.841015625 111.44,99.0"
            foreach pt $polyline {
                lassign [split $pt ,]  x y
                    # foreach {x y} [split $pt ,] break
                set x [expr {$x - 99.0}]
                set y [expr {$y - 99.0}]
                append polygon " $x,$y"
            }    
            #    puts $polygon
            set polygon {}
            set polyline "83.3,65.26 83.42384765625,65.47828125 83.59140625,65.654375 83.78919921875,65.79015625 84.00375,65.8875 84.22158203125001,65.94828125000001 84.42921875,65.974375 84.61318359375001,65.96765625 84.76,65.93 84.76,65.93 86.41900390625,65.26433593750001 88.11703125,64.6790625 89.85185546875,64.1767578125 91.62125,63.76 93.42298828125,63.4313671875 95.25484375,63.1934375 97.11458984375,63.0487890625 99.0,63.0 99.0,63.0 100.68580078125001,63.03865234375 102.35203125,63.15359375 103.99693359375,63.34330078125 105.61875,63.60625 107.21572265625001,63.94091796875 108.78609375,64.34578125 110.32810546875,64.81931640625 111.84,65.36 111.84,65.36 113.84615234375,66.3265625 116.03359375000001,67.74875 118.22455078125,69.5365625 120.24125000000001,71.60000000000001 121.90591796875,73.8490625 123.04078125000001,76.19375000000001 123.46806640625,78.5440625 123.01,80.81"
            foreach pt $polyline {
                lassign [split $pt ,]  x y
                    # foreach {x y} [split $pt ,] break
                set x [expr {$x - 99.0}]
                set y [expr {$y - 99.0}]
                append polygon " $x,$y"
            }    
            puts $polygon
        }    
            #set polyline    "12.6235,-1.2235 12.6243,-1.4196 12.5121,-2.331 12.2201,-5.2588 11.6905,-8.4246 10.9431,-11.8045 10.1805,-14.598 9.4629,-16.8689 8.842,-18.5659 7.929,-20.7067 6.6987,-23.1557 5.1259,-25.7772 3.1854,-28.4358 1.4197,-30.4377 -0.3266,-32.2934 -2.1765,-34.0033 -4.065,-35.5242 -6.2232,-37.027 -8.0833,-38.147 -10.4044,-39.344 -12.574,-40.2815 -15.1175,-41.1788 -17.4176,-41.8169 -19.8574,-42.3226 -22.8077,-42.7068 -26.0041,-42.8392 -29.519,-42.6786 -32.3469,-42.2909 -35.184,-41.6703 -37.3024,-41.0488 -39.2823,-40.339 -40.4544,-39.5728 -41.0095,-39.1048 -41.1849,-38.407 -40.8008,-36.8213 -40.5401,-36.1906 -40.3753,-36.0544 -40.1758,-35.9495 -39.946,-35.8356 -39.716,-35.7794 -39.4541,-35.7718 -39.2426,-35.8112 -39.0317,-35.8909 -38.8123,-35.9823 -38.2035,-36.2962 -36.7822,-36.9589 -35.1743,-37.5977 -33.0015,-38.2872 -30.829,-38.7902 -28.5234,-39.1322 -26.55,-39.2742 -24.1197,-39.2633 -21.4987,-39.0208 -18.9404,-38.5444 -16.4317,-37.8062 -13.9714,-36.8825 -11.341,-35.5553 -9.1219,-34.1477 -7.1697,-32.6505 -5.5012,-31.1377 -3.9845,-29.531 -2.7452,-28.0105 -1.4261,-26.1201 -0.7351,-23.5411 -1.0263,-20.6288 -0.7351,-23.5411 -1.4261,-26.1201 -2.7452,-28.0105 -3.9845,-29.531 -5.5012,-31.1377 -7.1697,-32.6505 -9.1219,-34.1477 -11.341,-35.5553 -13.9714,-36.8825 -16.4317,-37.8062 -18.9404,-38.5444 -21.4987,-39.0208 -24.1197,-39.2633 -26.55,-39.2742 -28.5234,-39.1322 -30.829,-38.7902 -33.0015,-38.2872 -35.1743,-37.5977 -36.7822,-36.9589 -38.2035,-36.2962 -38.8123,-35.9823 -39.0317,-35.8909 -39.2426,-35.8112 -39.4541,-35.7718 -39.716,-35.7794 -39.946,-35.8356 -40.1758,-35.9495 -40.3876,-36.0645 -40.5401,-36.1906 -40.3346,-35.6936 -40.07,-35.3547 -39.7637,-35.14 -39.2989,-34.9012 -38.6443,-34.6428 -37.9127,-34.3778 -37.1947,-34.0909 -36.4768,-33.7581 -35.7457,-33.3553 -34.9878,-32.8582 -31.5917,-30.5764 -27.9996,-27.9578 -24.4159,-24.7819 -20.2003,-20.1957 -16.7713,-15.5453 -15.3735,-13.3729 -14.7011,-11.9642 -14.0365,-10.2897 -13.5986,-9.044 -13.171,-7.6491 -12.8142,-6.1974 -12.5885,-4.7813 -12.5546,-3.4932 -12.6218,1.2235" 
        set polyline    $polylineOuterShape
            #
        set radius_SP   [expr {0.5 * $Scalar(Diameter)}]
            #
        set pt_31       [list $Scalar(Setback) $coneLength]    
        set pt_21       [list $Scalar(Setback) [expr {50 + $coneLength}]]
        set pt_11       [list $Scalar(Setback) $Scalar(Length)]
            #
            # set pt_31       [list $Scalar(PivotOffset) 50]    
            # set pt_21       [list $Scalar(PivotOffset) [expr 50 + $coneLength]]
            # set pt_11       [list $Scalar(PivotOffset) $Scalar(Length)]
            #
        set pt_10       [vectormath::addVector $pt_11   [list [expr {-1.0 * $radius_SP}]  0]]
        set pt_12       [vectormath::addVector $pt_11   [list [expr { 1.0 * $radius_SP}]  0]]
            #
        set pt_30       [vectormath::addVector $pt_31   [list [expr {-1.0 * $radius_SP}]  0]]
        set pt_32       [vectormath::addVector $pt_31   [list [expr { 1.0 * $radius_SP}]  0]]
            #
        foreach pt [list $pt_30 $pt_10 $pt_12 $pt_32 ] {
            lassign $pt  x y
                # foreach {x y} $pt break
            append polyline " $x,$y"
            # foreach {x y} $pt break
            # append polyline " $x,$y"
        }
            #   
            #
        set verticalOffset 7    
            #
        set polygon {}
        foreach pt $polyline {
            lassign [split $pt ,]  x y
                # foreach {x y} [split $pt ,] break
            set y [expr {$y + $verticalOffset}]
            append polygon " $x,$y"
        }
            #
        set polygon [string trim $polygon]    
            #
        set newNode [$compDoc createElement polygon]
            $compNode   appendChild     $newNode
            $newNode    setAttribute    id      OuterShape
            $newNode    setAttribute    style   "stroke:black;fill:#f2f2f2;stroke-width:0.2"
            $newNode    setAttribute    points  $polygon
            #
            
        set polyline {}
        foreach pt $polylineInnerShape {
            lassign [split $pt ,]  x y
                # foreach {x y} [split $pt ,] break
            set y [expr {$y + $verticalOffset}]
            append polyline " $x,$y"
        }
            #
        set polyline [string trim $polyline]    
            #
        set newNode [$compDoc createElement polyline]
            $compNode   appendChild     $newNode
            $newNode    setAttribute    id      InnerShape
            $newNode    setAttribute    style   "stroke:black;fill:#f2f2f2;stroke-width:0.2"
            $newNode    setAttribute    points  $polyline
            #
            
            #
            # puts "  ----> $polygon        "
            #
   
            #
            # -- cleanup attribure: xlmns from first layer
            #
        foreach childNode [$compNode childNodes] {
            # puts "  -> $childNode"
            catch {$childNode removeAttribute xmlns}
        }
            #
        # puts "[$ComponentNode(XZ) asXML]"    
            #
        return
            #

    }    
        #
}